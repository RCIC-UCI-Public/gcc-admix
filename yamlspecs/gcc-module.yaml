# Builds the module for gcc. It first includes all the definitions
# for the gcc build and then overwrites specific keys
!include gcc.yaml
!include /opt/rcic/include/rcic-module.yaml
---
- package: GCC Module
  pkgname: "{{ name }}_{{version}}-module"
  src_tarball: None
  no_src_dir: True
  category: compilers

  ## Define the key components of the environment module
  module:
    name: "{{ version }}"
    path: "{{ pkg_defaults.module.RCICmpath }}/{{ category }}/{{ name }}"
    setenv:
      - GCC_INSTALL_PREFIX  {{ prefix }}
      - CPP  {{ prefix }}/bin/cpp
      - CC  {{ prefix }}/bin/gcc
      - CXX  {{ prefix }}/bin/g++
      - OBJC  {{ prefix }}/bin/gcc
      - OBJCXX  {{ prefix }}/bin/g++
      - FC  {{ prefix }}/bin/gfortran
      - F77  {{ prefix }}/bin/gfortran
      - F90  {{ prefix }}/bin/gfortran

    prepend_path:
      - "{{ pkg_defaults.module.prepend_path }}"
      - -d " " LDFLAGS "-Wl,-rpath,{{ prefix }}/lib64" 
      - -d " " LDFLAGS "-L{{ prefix }}/lib64" 
      - LD_LIBRARY_PATH {{ prefix }}/lib64
      - LD_LIBRARY_PATH {{ prefix }}/lib/gcc/x86_64-pc-linux-gnu/{{ gcc_version }}

  requires:
    - "{{ name }}_{{ version }}"
    - rcic-module-support
